apiVersion: 1

groups:
  - orgId: 1
    name: RegTech Application Alerts
    folder: RegTech
    interval: 30s
    rules:
      - uid: application-down
        title: Application Down
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: up{job="regtech-app"} == 0
              intervalMs: 1000
              maxDataPoints: 43200
              refId: A
          - refId: B
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              intervalMs: 1000
              maxDataPoints: 43200
              refId: B
              type: reduce
        dashboardUid: operations-overview
        panelId: 1
        noDataState: NoData
        execErrState: Error
        for: 1m
        annotations:
          summary: "Application {{ $labels.instance }} is down"
          description: "Application has been down for more than 1 minute."
        labels:
          severity: critical
          service: application
        isPaused: false

      - uid: high-error-rate
        title: High Error Rate
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: sum(rate(http_server_requests_seconds_count{status=~"(4|5).."}[5m])) / sum(rate(http_server_requests_seconds_count[5m])) * 100 > 5
              intervalMs: 1000
              maxDataPoints: 43200
              refId: A
          - refId: B
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              intervalMs: 1000
              maxDataPoints: 43200
              refId: B
              type: reduce
        dashboardUid: operations-overview
        panelId: 5
        noDataState: NoData
        execErrState: Error
        for: 2m
        annotations:
          summary: "High error rate on {{ $labels.instance }}"
          description: "Error rate is {{ $value | printf \"%.2f\" }}% (threshold: 5%)"
        labels:
          severity: critical
          service: application
        isPaused: false

      - uid: high-response-time
        title: High Response Time
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 2
              intervalMs: 1000
              maxDataPoints: 43200
              refId: A
          - refId: B
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              intervalMs: 1000
              maxDataPoints: 43200
              refId: B
              type: reduce
        dashboardUid: operations-overview
        panelId: 6
        noDataState: NoData
        execErrState: Error
        for: 3m
        annotations:
          summary: "High response time on {{ $labels.instance }}"
          description: "95th percentile response time is {{ $value | printf \"%.2f\" }}s (threshold: 2s)"
        labels:
          severity: critical
          service: application
        isPaused: false

  - orgId: 1
    name: RegTech Infrastructure Alerts
    folder: RegTech
    interval: 30s
    rules:
      - uid: high-memory-usage
        title: High Memory Usage
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: (1 - jvm_memory_bytes_available / jvm_memory_bytes_max) * 100 > 95
              intervalMs: 1000
              maxDataPoints: 43200
              refId: A
          - refId: B
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              intervalMs: 1000
              maxDataPoints: 43200
              refId: B
              type: reduce
        dashboardUid: system-observability-health
        panelId: 4
        noDataState: NoData
        execErrState: Error
        for: 5m
        annotations:
          summary: "High memory usage on {{ $labels.instance }}"
          description: "Memory usage is {{ $value | printf \"%.1f\" }}% (threshold: 95%)"
        labels:
          severity: critical
          service: infrastructure
        isPaused: false

      - uid: database-connection-pool-exhausted
        title: Database Connection Pool Exhausted
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: hikaricp_connections_active / hikaricp_connections_max > 0.95
              intervalMs: 1000
              maxDataPoints: 43200
              refId: A
          - refId: B
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              intervalMs: 1000
              maxDataPoints: 43200
              refId: B
              type: reduce
        dashboardUid: system-observability-health
        panelId: 5
        noDataState: NoData
        execErrState: Error
        for: 2m
        annotations:
          summary: "Database connection pool exhausted on {{ $labels.instance }}"
          description: "Connection pool utilization is {{ $value | printf \"%.1f\" }}% (threshold: 95%)"
        labels:
          severity: critical
          service: database
        isPaused: false

  - orgId: 1
    name: RegTech SLA Alerts
    folder: RegTech
    interval: 60s
    rules:
      - uid: sla-availability-violation
        title: SLA Availability Violation
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 1800
              to: 0
            datasourceUid: prometheus
            model:
              expr: (1 - sum(rate(http_server_requests_seconds_count{status=~"(5).."}[30m])) / sum(rate(http_server_requests_seconds_count[30m]))) * 100 < 99.9
              intervalMs: 1000
              maxDataPoints: 43200
              refId: A
          - refId: B
            relativeTimeRange:
              from: 1800
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              intervalMs: 1000
              maxDataPoints: 43200
              refId: B
              type: reduce
        dashboardUid: sla-api-performance
        panelId: 1
        noDataState: NoData
        execErrState: Error
        for: 5m
        annotations:
          summary: "SLA Availability Violation"
          description: "30-minute availability is {{ $value | printf \"%.2f\" }}% (SLA: 99.9%)"
        labels:
          severity: critical
          service: sla
        isPaused: false

      - uid: sla-response-time-violation
        title: SLA Response Time Violation
        condition: B
        data:
          - refId: A
            relativeTimeRange:
              from: 1800
              to: 0
            datasourceUid: prometheus
            model:
              expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[30m])) by (le)) > 0.5
              intervalMs: 1000
              maxDataPoints: 43200
              refId: A
          - refId: B
            relativeTimeRange:
              from: 1800
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 0
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
                  reducer:
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              intervalMs: 1000
              maxDataPoints: 43200
              refId: B
              type: reduce
        dashboardUid: sla-api-performance
        panelId: 2
        noDataState: NoData
        execErrState: Error
        for: 5m
        annotations:
          summary: "SLA Response Time Violation"
          description: "95th percentile response time is {{ $value | printf \"%.3f\" }}s (SLA: 500ms)"
        labels:
          severity: critical
          service: sla
        isPaused: false