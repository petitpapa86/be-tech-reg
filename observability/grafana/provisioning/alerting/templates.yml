templates:
  - name: 'regtech_default'
    template: |
      {{ define "alerts.message" }}
      {{ range . }}
      **Alert:** {{ .Annotations.summary }}
      **Description:** {{ .Annotations.description }}
      **Severity:** {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}unknown{{ end }}
      **Service:** {{ if .Labels.service }}{{ .Labels.service }}{{ else }}unknown{{ end }}
      **Instance:** {{ if .Labels.instance }}{{ .Labels.instance }}{{ else }}unknown{{ end }}
      **Status:** {{ .Status | toUpper }}
      {{ if .Annotations.runbook_url }}
      **Runbook:** {{ .Annotations.runbook_url }}
      {{ end }}
      {{ if .Annotations.dashboard_url }}
      **Dashboard:** {{ .Annotations.dashboard_url }}
      {{ end }}
      ---
      {{ end }}
      {{ end }}

  - name: 'regtech_slack'
    template: |
      {{ define "slack.message" }}
      {{ if .Alerts.Firing }}
      :fire: *{{ len .Alerts.Firing }} alert(s) firing*
      {{ range .Alerts.Firing }}
      • *{{ .Annotations.summary }}*
        Severity: `{{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}unknown{{ end }}`
        Service: `{{ if .Labels.service }}{{ .Labels.service }}{{ else }}unknown{{ end }}`
        Instance: `{{ if .Labels.instance }}{{ .Labels.instance }}{{ else }}unknown{{ end }}`
        {{ if .Annotations.runbook_url }}
        Runbook: {{ .Annotations.runbook_url }}
        {{ end }}
      {{ end }}
      {{ end }}

      {{ if .Alerts.Resolved }}
      :white_check_mark: *{{ len .Alerts.Resolved }} alert(s) resolved*
      {{ range .Alerts.Resolved }}
      • *{{ .Annotations.summary }}*
        Resolved at: {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
      {{ end }}
      {{ end }}
      {{ end }}

  - name: 'regtech_email'
    template: |
      {{ define "email.message" }}
      <!DOCTYPE html>
      <html>
      <head>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .alert { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
          .critical { border-color: #dc3545; background-color: #f8d7da; }
          .warning { border-color: #ffc107; background-color: #fff3cd; }
          .info { border-color: #17a2b8; background-color: #d1ecf1; }
          .header { font-weight: bold; margin-bottom: 5px; }
          .label { font-weight: bold; color: #666; }
        </style>
      </head>
      <body>
        <h2>RegTech Platform Alert Notification</h2>

        {{ if .Alerts.Firing }}
        <h3>{{ len .Alerts.Firing }} Alert(s) Firing</h3>
        {{ range .Alerts.Firing }}
        <div class="alert {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}info{{ end }}">
          <div class="header">{{ .Annotations.summary }}</div>
          <p><span class="label">Description:</span> {{ .Annotations.description }}</p>
          <p><span class="label">Severity:</span> {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}unknown{{ end }}</p>
          <p><span class="label">Service:</span> {{ if .Labels.service }}{{ .Labels.service }}{{ else }}unknown{{ end }}</p>
          <p><span class="label">Instance:</span> {{ if .Labels.instance }}{{ .Labels.instance }}{{ else }}unknown{{ end }}</p>
          <p><span class="label">Started:</span> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
          {{ if .Annotations.runbook_url }}
          <p><span class="label">Runbook:</span> <a href="{{ .Annotations.runbook_url }}">{{ .Annotations.runbook_url }}</a></p>
          {{ end }}
          {{ if .Annotations.dashboard_url }}
          <p><span class="label">Dashboard:</span> <a href="{{ .Annotations.dashboard_url }}">{{ .Annotations.dashboard_url }}</a></p>
          {{ end }}
        </div>
        {{ end }}
        {{ end }}

        {{ if .Alerts.Resolved }}
        <h3>{{ len .Alerts.Resolved }} Alert(s) Resolved</h3>
        {{ range .Alerts.Resolved }}
        <div class="alert info">
          <div class="header">{{ .Annotations.summary }}</div>
          <p><span class="label">Resolved:</span> {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
        </div>
        {{ end }}
        {{ end }}
      </body>
      </html>
      {{ end }}

  - name: 'regtech_pagerduty'
    template: |
      {{ define "pagerduty.message" }}
      {{ if .Alerts.Firing }}
      {{ range .Alerts.Firing }}
      **INCIDENT: {{ .Annotations.summary }}**

      **Description:** {{ .Annotations.description }}
      **Severity:** {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}unknown{{ end }}
      **Service:** {{ if .Labels.service }}{{ .Labels.service }}{{ else }}unknown{{ end }}
      **Instance:** {{ if .Labels.instance }}{{ .Labels.instance }}{{ else }}unknown{{ end }}
      **Status:** FIRING
      **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

      {{ if .Annotations.runbook_url }}
      **Runbook:** {{ .Annotations.runbook_url }}
      {{ end }}

      {{ if .Annotations.dashboard_url }}
      **Dashboard:** {{ .Annotations.dashboard_url }}
      {{ end }}

      ---
      {{ end }}
      {{ end }}
      {{ end }}

  - name: 'regtech_webhook'
    template: |
      {{ define "webhook.message" }}
      {
        "platform": "RegTech",
        "status": "{{ .Status }}",
        "receiver": "{{ .Receiver }}",
        "externalURL": "{{ .ExternalURL }}",
        "alerts": [
          {{ range $index, $alert := .Alerts }}{{ if $index }},{{ end }}
          {
            "status": "{{ $alert.Status }}",
            "labels": {
              "alertname": "{{ index $alert.Labels "alertname" }}",
              "severity": "{{ index $alert.Labels "severity" }}",
              "service": "{{ index $alert.Labels "service" }}"
            },
            "annotations": {
              "summary": "{{ index $alert.Annotations "summary" }}",
              "description": "{{ index $alert.Annotations "description" }}"
            },
            "startsAt": "{{ $alert.StartsAt.Format "2006-01-02T15:04:05Z07:00" }}"
          }{{ end }}
        ]
      }
      {{ end }}