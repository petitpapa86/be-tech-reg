groups:
  - name: regtech-application-alerts
    rules:
      # Critical Application Alerts
      - alert: ApplicationDown
        expr: up{job="regtech-app"} == 0
        for: 1m
        labels:
          severity: critical
          service: application
        annotations:
          summary: "Application {{ $labels.instance }} is down"
          description: "Application {{ $labels.instance }} has been down for more than 1 minute."

      - alert: HighErrorRate
        expr: sum(rate(http_server_requests_seconds_count{status=~"(4|5).."}[5m])) / sum(rate(http_server_requests_seconds_count[5m])) * 100 > 5
        for: 2m
        labels:
          severity: critical
          service: application
        annotations:
          summary: "High error rate on {{ $labels.instance }}"
          description: "Error rate is {{ $value | printf \"%.2f\" }}% (threshold: 5%)"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 2
        for: 3m
        labels:
          severity: critical
          service: application
        annotations:
          summary: "High response time on {{ $labels.instance }}"
          description: "95th percentile response time is {{ $value | printf \"%.2f\" }}s (threshold: 2s)"

      # Warning Application Alerts
      - alert: ModerateErrorRate
        expr: sum(rate(http_server_requests_seconds_count{status=~"(4|5).."}[5m])) / sum(rate(http_server_requests_seconds_count[5m])) * 100 > 1
        for: 5m
        labels:
          severity: warning
          service: application
        annotations:
          summary: "Moderate error rate on {{ $labels.instance }}"
          description: "Error rate is {{ $value | printf \"%.2f\" }}% (threshold: 1%)"

      - alert: ModerateResponseTime
        expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 1
        for: 5m
        labels:
          severity: warning
          service: application
        annotations:
          summary: "Moderate response time on {{ $labels.instance }}"
          description: "95th percentile response time is {{ $value | printf \"%.2f\" }}s (threshold: 1s)"

      - alert: LowAvailability
        expr: (1 - sum(rate(http_server_requests_seconds_count{status=~"(5).."}[5m])) / sum(rate(http_server_requests_seconds_count[5m]))) * 100 < 99.9
        for: 5m
        labels:
          severity: warning
          service: application
        annotations:
          summary: "Low availability on {{ $labels.instance }}"
          description: "Availability is {{ $value | printf \"%.2f\" }}% (threshold: 99.9%)"

  - name: regtech-database-alerts
    rules:
      # Critical Database Alerts
      - alert: DatabaseDown
        expr: up{job="postgres"} == 0
        for: 1m
        labels:
          severity: critical
          service: database
        annotations:
          summary: "Database {{ $labels.instance }} is down"
          description: "PostgreSQL database has been down for more than 1 minute."

      - alert: DatabaseConnectionPoolExhausted
        expr: hikaricp_connections_active / hikaricp_connections_max > 0.95
        for: 2m
        labels:
          severity: critical
          service: database
        annotations:
          summary: "Database connection pool exhausted on {{ $labels.instance }}"
          description: "Connection pool utilization is {{ $value | printf \"%.1f\" }}% (threshold: 95%)"

      # Warning Database Alerts
      - alert: HighDatabaseConnections
        expr: hikaricp_connections_active / hikaricp_connections_max > 0.8
        for: 5m
        labels:
          severity: warning
          service: database
        annotations:
          summary: "High database connection usage on {{ $labels.instance }}"
          description: "Connection pool utilization is {{ $value | printf \"%.1f\" }}% (threshold: 80%)"

      - alert: SlowDatabaseQueries
        expr: increase(pg_stat_activity_max_tx_duration{datname="mydatabase"}[5m]) > 300
        for: 2m
        labels:
          severity: warning
          service: database
        annotations:
          summary: "Slow database queries detected"
          description: "Long-running transactions detected (max duration > 5 minutes)"

  - name: regtech-infrastructure-alerts
    rules:
      # Critical Infrastructure Alerts
      - alert: HighMemoryUsage
        expr: (1 - jvm_memory_bytes_available / jvm_memory_bytes_max) * 100 > 95
        for: 5m
        labels:
          severity: critical
          service: application
        annotations:
          summary: "High memory usage on {{ $labels.instance }}"
          description: "Memory usage is {{ $value | printf \"%.1f\" }}% (threshold: 95%)"

      - alert: HighCpuUsage
        expr: rate(process_cpu_user_seconds_total[5m]) * 100 > 90
        for: 5m
        labels:
          severity: critical
          service: application
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          description: "CPU usage is {{ $value | printf \"%.1f\" }}% (threshold: 90%)"

      # Warning Infrastructure Alerts
      - alert: ModerateMemoryUsage
        expr: (1 - jvm_memory_bytes_available / jvm_memory_bytes_max) * 100 > 85
        for: 10m
        labels:
          severity: warning
          service: application
        annotations:
          summary: "Moderate memory usage on {{ $labels.instance }}"
          description: "Memory usage is {{ $value | printf \"%.1f\" }}% (threshold: 85%)"

      - alert: ModerateCpuUsage
        expr: rate(process_cpu_user_seconds_total[5m]) * 100 > 75
        for: 10m
        labels:
          severity: warning
          service: application
        annotations:
          summary: "Moderate CPU usage on {{ $labels.instance }}"
          description: "CPU usage is {{ $value | printf \"%.1f\" }}% (threshold: 75%)"

  - name: regtech-observability-alerts
    rules:
      # Critical Observability Alerts
      - alert: PrometheusDown
        expr: up{job="prometheus"} == 0
        for: 1m
        labels:
          severity: critical
          service: observability
        annotations:
          summary: "Prometheus is down"
          description: "Prometheus metrics collection is not available."

      - alert: GrafanaDown
        expr: up{job="grafana"} == 0
        for: 1m
        labels:
          severity: critical
          service: observability
        annotations:
          summary: "Grafana is down"
          description: "Grafana dashboard access is not available."

      - alert: OpenTelemetryCollectorDown
        expr: up{job="otel-collector"} == 0
        for: 1m
        labels:
          severity: critical
          service: observability
        annotations:
          summary: "OpenTelemetry Collector is down"
          description: "Telemetry data collection has stopped."

      # Warning Observability Alerts
      - alert: LokiDown
        expr: up{job="loki"} == 0
        for: 5m
        labels:
          severity: warning
          service: observability
        annotations:
          summary: "Loki is down"
          description: "Log aggregation is not available."

      - alert: TempoDown
        expr: up{job="tempo"} == 0
        for: 5m
        labels:
          severity: warning
          service: observability
        annotations:
          summary: "Tempo is down"
          description: "Distributed tracing is not available."

  - name: regtech-business-alerts
    rules:
      # Critical Business Alerts
      - alert: BusinessTransactionFailureRate
        expr: rate(regtech_business_transactions_failed_total[5m]) / rate(regtech_business_transactions_total[5m]) * 100 > 5
        for: 5m
        labels:
          severity: critical
          service: business
        annotations:
          summary: "High business transaction failure rate"
          description: "Business transaction failure rate is {{ $value | printf \"%.2f\" }}% (threshold: 5%)"

      - alert: DataQualityScoreLow
        expr: regtech_data_quality_score < 90
        for: 10m
        labels:
          severity: critical
          service: business
        annotations:
          summary: "Low data quality score"
          description: "Data quality score is {{ $value | printf \"%.1f\" }} (threshold: 90)"

      # Warning Business Alerts
      - alert: ModerateBusinessTransactionFailures
        expr: rate(regtech_business_transactions_failed_total[5m]) / rate(regtech_business_transactions_total[5m]) * 100 > 1
        for: 10m
        labels:
          severity: warning
          service: business
        annotations:
          summary: "Moderate business transaction failure rate"
          description: "Business transaction failure rate is {{ $value | printf \"%.2f\" }}% (threshold: 1%)"

      - alert: DataQualityScoreWarning
        expr: regtech_data_quality_score < 95
        for: 15m
        labels:
          severity: warning
          service: business
        annotations:
          summary: "Data quality score warning"
          description: "Data quality score is {{ $value | printf \"%.1f\" }} (threshold: 95)"

  - name: regtech-sla-alerts
    rules:
      # SLA Violation Alerts
      - alert: SLAAvailabilityViolation
        expr: (1 - sum(rate(http_server_requests_seconds_count{status=~"(5).."}[30m])) / sum(rate(http_server_requests_seconds_count[30m]))) * 100 < 99.9
        for: 5m
        labels:
          severity: critical
          service: sla
        annotations:
          summary: "SLA Availability Violation"
          description: "30-minute availability is {{ $value | printf \"%.2f\" }}% (SLA: 99.9%)"

      - alert: SLAResponseTimeViolation
        expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[30m])) by (le)) > 0.5
        for: 5m
        labels:
          severity: critical
          service: sla
        annotations:
          summary: "SLA Response Time Violation"
          description: "95th percentile response time is {{ $value | printf \"%.3f\" }}s (SLA: 500ms)"

      - alert: SLAErrorRateViolation
        expr: sum(rate(http_server_requests_seconds_count{status=~"(4|5).."}[30m])) / sum(rate(http_server_requests_seconds_count[30m])) * 100 > 0.1
        for: 5m
        labels:
          severity: critical
          service: sla
        annotations:
          summary: "SLA Error Rate Violation"
          description: "30-minute error rate is {{ $value | printf \"%.2f\" }}% (SLA: 0.1%)"